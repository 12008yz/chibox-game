#!/usr/bin/env node

/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ç–∞–π–º–µ—Ä–æ–≤ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∫–µ–π—Å–æ–≤
 * –û–±–Ω—É–ª—è–µ—Ç next_case_available_time –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
 * –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∫–µ–π—Å—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Å 24 —á–∞—Å–æ–≤ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
 */

const db = require('../models');

async function resetCaseTimers() {
  try {
    console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º —Å–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–æ–≤ –∫–µ–π—Å–æ–≤...');

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const [updatedCount] = await db.User.update(
      {
        next_case_available_time: null,
        cases_opened_today: 0,
        last_reset_date: new Date()
      },
      {
        where: {}
      }
    );

    console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–±—Ä–æ—à–µ–Ω—ã —Ç–∞–π–º–µ—Ä—ã –¥–ª—è ${updatedCount} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
    console.log('üéØ –¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∞—Ç—å –∫–µ–π—Å—ã –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥!');

    process.exit(0);
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ —Ç–∞–π–º–µ—Ä–æ–≤:', error);
    process.exit(1);
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç
resetCaseTimers();
