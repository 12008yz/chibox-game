# Импорт предметов с LIS-Skins

## Обзор скриптов импорта

В системе есть два скрипта для импорта предметов с LIS-Skins:

1. **import-lis-items.js** - базовый скрипт, который импортирует предметы по категориям.
2. **import-lis-items-improved.js** - улучшенный скрипт с расширенными возможностями.

## Использование улучшенного скрипта

Улучшенный скрипт предлагает больше возможностей для настройки и контроля процесса импорта.

### Простой запуск

```bash
node scripts/import-lis-items-improved.js
```

### Запуск с параметрами

```bash
node scripts/import-lis-items-improved.js --max-items 100 --max-pages 2 --delay 1500
```

### Доступные параметры

- `--stickers` или `-s`: Импортировать стикеры (по умолчанию пропускаются)
- `--no-stattrak` или `-ns`: Не импортировать предметы StatTrak (по умолчанию импортируются)
- `--max-pages N`: Максимальное количество страниц на категорию (по умолчанию все)
- `--max-items N`: Максимальное общее количество предметов для импорта (по умолчанию все)
- `--delay N`: Задержка между запросами в миллисекундах (по умолчанию 1000 мс)

## Предварительные требования

Перед использованием скрипта убедитесь, что:

1. Файл конфигурации `config/lis_config.json` содержит актуальные cookies и CSRF-токен для LIS-Skins.
2. Вы можете обновить эти данные командой:
   ```bash
   node scripts/setup-lis-config.js
   ```

## Обработка ошибок

Скрипт включает обработку ошибок с автоматическими повторными попытками:

- При ошибке получения списка предметов - до 3 повторных попыток с паузой 5 секунд
- При ошибке получения деталей предмета - до 3 повторных попыток с паузой 3 секунды

## Журналирование

Лог работы скрипта сохраняется в файл `logs/import-lis-items-improved.log`.

## Регулярный импорт

Для регулярного импорта можно добавить задачу в cron:

```javascript
// В файле scripts/setup-cron.js добавьте:

// Импорт предметов с LIS-Skins каждую неделю в понедельник в 03:00
cron.schedule('0 3 * * 1', async () => {
  logger.info('Запуск еженедельного импорта предметов с LIS-Skins...');
  try {
    const importLisItems = require('./import-lis-items-improved');
    await importLisItems({ maxItems: 10000 }); // Не более 10000 предметов за раз
    logger.info('Еженедельный импорт предметов с LIS-Skins завершен');
  } catch (error) {
    logger.error('Ошибка при импорте предметов с LIS-Skins:', error);
  }
});
```

## Подсчет статистики

После завершения работы скрипт выводит подробную статистику импорта:

- По категориям
- Общее количество обработанных предметов
- Количество добавленных новых предметов
- Количество обновленных предметов
- Количество предметов без изменений
- Количество пропущенных предметов
- Количество ошибок
