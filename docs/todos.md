# Задачи по реализации системы бонусов к drop_weight

## Основная задача

Реализовать систему, где пользователи при получении достижений или повышении уровня получают бонус к шансу выпадения дорогих предметов через модификацию drop_weight.

## Текущее состояние системы

- ✅ Система drop_weight уже настроена в fix-drop-weights.js
- ✅ У пользователей есть поля achievements_bonus_percentage, level_bonus_percentage, total_drop_bonus_percentage
- ✅ Система достижений работает в achievementService.js
- ✅ Открытие кейсов использует drop_weight в openCase.js (строки 113-125)

## Задачи для реализации

### 1. Обновить систему достижений для начисления бонусов к drop_weight

- [completed] Модифицировать achievementService.js для правильного начисления бонусов
- [completed] Обновить поле achievements_bonus_percentage вместо bonus_chance

### 2. Создать функцию расчета модифицированного drop_weight

- [completed] Создать функцию, которая учитывает бонусы пользователя при расчете drop_weight
- [completed] Функция должна повышать шансы на дорогие предметы при наличии бонусов

### 3. Модифицировать логику открытия кейсов

- [completed] Интегрировать модифицированный drop_weight в openCase.js
- [completed] Учитывать total_drop_bonus_percentage при выборе предмета

### 4. Обновить систему уровней

- [completed] Добавить начисление level_bonus_percentage при повышении уровня
- [completed] Обновить xpService.js для расчета бонусов за уровень

### 5. Создать функцию пересчета общего бонуса

- [completed] Функция для обновления total_drop_bonus_percentage
- [completed] Суммировать бонусы от достижений, уровня и подписки

### 6. Тестирование и балансировка

- [completed] Создать скрипт для тестирования новой системы
- [completed] Проверить корректность начисления бонусов
- [completed] Сбалансировать размеры бонусов

### 7. Дополнительные улучшения (ЗАВЕРШЕНО)

- [completed] Обновить subscriptionService для учета бонусов при покупке подписки
- [completed] Создать API эндпоинт для получения информации о бонусах пользователя
- [completed] Добавить маршрут /bonus-info для фронтенда

## Статус

- [ ] not_started
- [ ] in_progress
- [ ] completed
