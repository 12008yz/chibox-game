# –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ JSON API - –ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è JSON API PayKeeper:
- **URL:** https://paykeeper.alfabank.ru/dokumentatsiya-json-api/
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–µ—Ç–æ–¥–∞–º JSON API –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞

## üîë –¢–∏–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–¥–≤–∞ —Ç–∏–ø–∞ –ª–æ–≥–∏–Ω–æ–≤**:

1. **–õ–æ–≥–∏–Ω —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-operator`:**
   - –î–ª—è –≤—Ö–æ–¥–∞ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤
   - **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è API!**

2. **–õ–æ–≥–∏–Ω —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-api`:**
   - –î–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON API
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ –ø–ª–∞—Ç–µ–∂–Ω–æ–º—É —à–ª—é–∑—É
   - **–≠—Ç–æ—Ç –ª–æ–≥–∏–Ω –Ω—É–∂–µ–Ω –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏!**

## üîê –ü–æ–ª—É—á–µ–Ω–∏–µ API –ø–∞—Ä–æ–ª—è

### –ß–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç

1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: https://pay.alfabank.ru/lk/login
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–≥–∏–Ω —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-operator` (–¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
3. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" –∏–ª–∏ "API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
4. –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ª–æ–≥–∏–Ω–æ–º `-api`

### –ß–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É

–ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É –∏–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
- –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É: 8-800-200-00-00
- –ó–∞–ø—Ä–æ—Å–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã API

### 1. register.do - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞

**URL:** `https://pay.alfabank.ru/payment/rest/register.do`

**–ú–µ—Ç–æ–¥:** POST

**Content-Type:** `application/x-www-form-urlencoded`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `userName` - –ª–æ–≥–∏–Ω API (—Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-api`)
- `password` - –ø–∞—Ä–æ–ª—å API
- `orderNumber` - –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤ —Ä–∞–º–∫–∞—Ö –º–∞–≥–∞–∑–∏–Ω–∞)
- `amount` - —Å—É–º–º–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö
- `returnUrl` - URL –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
- `failUrl` - URL –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω–æ–π –æ–ø–ª–∞—Ç—ã
- `description` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- `callbackUrl` - URL –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤–µ–±—Ö—É–∫–æ–≤)

**–û—Ç–≤–µ—Ç:**
```json
{
  "formUrl": "https://payment.alfabank.ru/payment/merchants/...",
  "orderId": "0146cd33-3eab-75f5-a284-bda502b182c2",
  "errorCode": "0"
}
```

### 2. getOrderStatusExtended.do - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**URL:** `https://pay.alfabank.ru/payment/rest/getOrderStatusExtended.do`

**–ú–µ—Ç–æ–¥:** POST

**Content-Type:** `application/x-www-form-urlencoded`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `userName` - –ª–æ–≥–∏–Ω API
- `password` - –ø–∞—Ä–æ–ª—å API
- `orderId` - ID –∑–∞–∫–∞–∑–∞ (–∏–∑ –æ—Ç–≤–µ—Ç–∞ register.do) –∏–ª–∏ `orderNumber`

**–û—Ç–≤–µ—Ç:**
```json
{
  "orderStatus": 2,
  "orderNumber": "123",
  "amount": 1000,
  "errorCode": "0"
}
```

### 3. Callback —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π `callbackUrl` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
- `orderNumber` - –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
- `status` - —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ (0, 1, 2, 3, 6)
- `checksum` - –ø–æ–¥–ø–∏—Å—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- `mdOrder` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID –∑–∞–∫–∞–∑–∞ (–¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π)

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:**
   - API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `application/x-www-form-urlencoded`, –∞ –Ω–µ JSON
   - –°—É–º–º–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **–∫–æ–ø–µ–π–∫–∞—Ö** (–Ω–µ –≤ —Ä—É–±–ª—è—Ö!)

2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–≥–∏–Ω —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-api`
   - –ü–∞—Ä–æ–ª—å API (–ù–ï –ø–∞—Ä–æ–ª—å –æ—Ç –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞!)

3. **–°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π:**
   - `0` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ –Ω–µ –æ–ø–ª–∞—á–µ–Ω
   - `1` - –ø—Ä–µ–¥–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (—Ö–æ–ª–¥)
   - `2` - —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω ‚úÖ
   - `3` - –æ—Ç–º–µ–Ω–µ–Ω
   - `6` - –æ—Ç–∫–ª–æ–Ω–µ–Ω

4. **Callback URL:**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
   - –î–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS
   - –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `callbackUrl` –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã API

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
pm2 logs --lines 50
```

**–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
```
‚úÖ Dynamic payment created via API
```

**–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
```
errorCode: '5', errorMessage: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω'
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞: 8-800-200-00-00
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://paykeeper.alfabank.ru/dokumentatsiya-json-api/
- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: https://pay.alfabank.ru/lk/login
